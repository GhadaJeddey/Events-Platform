<div class="dashboard-container">
    <!-- Header -->
    <div class="dashboard-header">
        <div class="header-content">
            <h1 class="header-title">Tableau de Bord</h1>
            <p class="header-date">{{ currentDate | date:'d MMM yyyy' }}</p>
        </div>
        <div class="header-actions">
            <app-button label="Exporter" variant="secondary"></app-button>
            <app-button label="Créer un événement" variant="primary" className="create-event-btn"
                (btnClick)="goToCreateEvent()">
            </app-button>
        </div>

    </div>

     <!-- Recent Events -->
    <div class="recent-events-section">
        <div class="section-header">
            <h2 class="section-title">Mes Événements Récents</h2>
            <a routerLink="/events" class="view-all-link">Voir tous →</a>
        </div>

        @if (myEvents() && myEvents().length > 0) {
        <div class="events-grid">
            @for(event of myEvents().slice(0, 6); track event.id) {
            <app-event-card [event]="event"></app-event-card>
            }
        </div>
        } @else {
        <div class="no-results-message">
            <p class="main-text">Aucun événement pour le moment.</p>
            <a routerLink="/events/create" class="btn-create">Créer mon premier événement</a>
        </div>
        }
    </div>
    
    <!-- Key Metrics -->
    @if (stats()) {
    <div class="metrics-section">
        <div class="metrics-grid">
            <div class="metric-card">
                <div class="metric-top">
                    <p class="metric-label">Total Événements</p>
                    <span class="metric-badge">{{ stats()?.total }}</span>
                </div>
                <p class="metric-value">{{ stats()?.upcoming }}</p>
                <p class="metric-sub">À venir cette année</p>
            </div>
            <div class="metric-card">
                <div class="metric-top">
                    <p class="metric-label">Participants</p>
                    <span class="metric-badge success">{{ stats()?.participants }}</span>
                </div>
                <p class="metric-value">{{ stats()?.fillRate }}%</p>
                <p class="metric-sub">Taux moyen</p>
            </div>
            <div class="metric-card">
                <div class="metric-top">
                    <p class="metric-label">En Cours</p>
                    <span class="metric-badge info">{{ stats()?.ongoing }}</span>
                </div>
                <p class="metric-value">{{ stats()?.completed }}</p>
                <p class="metric-sub">Terminés</p>
            </div>
        </div>
    </div>
    }

    <!-- Main Charts Section -->
    <div class="charts-main-section">
        <!-- Area Chart -->
        <div class="area-chart-card">
            <div class="chart-header">
                <div>
                    <h3 class="chart-title">Événements Créés</h3>
                    <p class="chart-subtitle">Tendance mensuelle 2026</p>
                </div>
                <div class="chart-tabs">
                    <button class="tab-btn active">Mensuel</button>
                    <button class="tab-btn">Annuel</button>
                </div>
            </div>
            <svg class="area-chart-svg" viewBox="0 0 700 300" preserveAspectRatio="none">
                <!-- Grid lines -->
                <line x1="50" y1="250" x2="650" y2="250" class="grid-line" />
                <line x1="50" y1="190" x2="650" y2="190" class="grid-line" />
                <line x1="50" y1="130" x2="650" y2="130" class="grid-line" />
                <line x1="50" y1="70" x2="650" y2="70" class="grid-line" />

                <!-- Area fill -->
                <defs>
                    <linearGradient id="areaGradient" x1="0%" y1="0%" x2="0%" y2="100%">
                        <stop offset="0%" style="stop-color:#3498db;stop-opacity:0.3" />
                        <stop offset="100%" style="stop-color:#3498db;stop-opacity:0" />
                    </linearGradient>
                </defs>

                <!-- Polyline area -->
                <polyline class="area-polyline" [attr.points]="svgAreaPoints()" fill="url(#areaGradient)" stroke="none">
                </polyline>

                <!-- Polyline line -->
                <polyline class="area-line" [attr.points]="svgPoints()" fill="none" stroke="#3498db" stroke-width="3"
                    stroke-linecap="round" stroke-linejoin="round">
                </polyline>

                <!-- Data points -->
                <g *ngFor="let v of eventsPerMonth(); let i = index">
                    <circle class="data-point" [attr.cx]="60 + (i/11)*590"
                        [attr.cy]="250 - (v / maxEventsPerMonth())*180" r="5" />
                </g>
            </svg>
            <div class="area-chart-legend">
                <div class="legend-item">
                    <span class="legend-dot"></span>
                    <span class="legend-text">Événements</span>
                </div>
                <div class="legend-stats">
                    <span>Moyenne: {{ (stats()?.total || 0) }}</span>
                    <span>•</span>
                    <span>Max: {{ maxEventsPerMonth() }}</span>
                </div>
            </div>
        </div>

        
    </div>

    <!-- Bottom Charts -->
    <div class="bottom-charts-grid">
        <div class="bar-chart-card">
            <div class="chart-header">
                <h3 class="chart-title">Répartition par Statut</h3>
                <p class="chart-subtitle">Tous vos événements</p>
            </div>
            <div class="bar-chart">
                <div class="bar-item">
                    <div class="bar-wrapper">
                        <div class="bar upcoming" [style.width.%]="(statusBreakdown().upcoming || 0) * 15">
                            <span class="bar-tooltip">{{ statusBreakdown().upcoming }}</span>
                        </div>
                    </div>
                    <p class="bar-name">À venir</p>
                </div>
                <div class="bar-item">
                    <div class="bar-wrapper">
                        <div class="bar ongoing" [style.width.%]="(statusBreakdown().ongoing || 0) * 15">
                            <span class="bar-tooltip">{{ statusBreakdown().ongoing }}</span>
                        </div>
                    </div>
                    <p class="bar-name">En cours</p>
                </div>
                <div class="bar-item">
                    <div class="bar-wrapper">
                        <div class="bar completed" [style.width.%]="(statusBreakdown().completed || 0) * 15">
                            <span class="bar-tooltip">{{ statusBreakdown().completed }}</span>
                        </div>
                    </div>
                    <p class="bar-name">Terminés</p>
                </div>
                <div class="bar-item">
                    <div class="bar-wrapper">
                        <div class="bar pending" [style.width.%]="(statusBreakdown().pending || 0) * 15">
                            <span class="bar-tooltip">{{ statusBreakdown().pending }}</span>
                        </div>
                    </div>
                    <p class="bar-name">Attente</p>
                </div>
                <div class="bar-item">
                    <div class="bar-wrapper">
                        <div class="bar rejected" [style.width.%]="(statusBreakdown().rejected || 0) * 15">
                            <span class="bar-tooltip">{{ statusBreakdown().rejected }}</span>
                        </div>
                    </div>
                    <p class="bar-name">Rejetés</p>
                </div>
            </div>
        </div>

    </div>

   
</div>