<div class="dashboard-container">
    <div class="dashboard-header">
        <div class="header-content">
            <h1 class="header-title">Tableau de Bord</h1>
            <p class="header-date">{{ currentDate | date:'d MMM yyyy' }}</p>
        </div>
        <div class="header-actions">
            <button  class="create-event-btn" (click)="goToCreateEvent()"> Créer un événement  →
            </button>

        </div>
    </div>

    @if (stats()) {
    <div class="metrics-section">
        <div class="metrics-grid">
            <div class="metric-card">
                <div class="metric-top">
                    <p class="metric-label">Total Événements</p>
                    <span class="metric-badge">{{ stats()?.total }}</span>
                </div>
            </div>
            <div class="metric-card">
                <div class="metric-top">
                    <p class="metric-label">Participants</p>
                    <span class="metric-badge success">{{ stats()?.participants }}</span>
                </div>

            </div>
            <div class="metric-card">
                <div class="metric-top">
                    <p class="metric-label">En Cours</p>
                    <span class="metric-badge info">{{ stats()?.ongoing }}</span>
                </div>

            </div>
        </div>
    </div>
    }

    <div class="recent-events-section">
        <div class="section-header">
            <h2 class="section-title">Mes Événements Récents</h2>
            <a routerLink="/organizer/dashboard/tous" class="view-all-link">Voir tous →</a>
        </div>

        @if (myEvents() && myEvents().length > 0) {
        <div class="events-grid">
            @for(event of myEvents().slice(0, 6); track event.id) {
            <app-event-card [event]="event" [mode]="'organizer'"></app-event-card>
            }
        </div>
        } @else {
        <div class="no-results-message">
            <p class="main-text">Aucun événement pour le moment.</p>
            <a routerLink="/events/create" class="btn-create">Créer mon premier événement</a>
        </div>
        }
    </div>

    <div class="charts-wrapper">
        <div class="charts-main-section">
            <div class="area-chart-card">
                <div class="chart-header">
                    <div>
                        <h3 class="chart-title">Événements Créés</h3>
                        <p class="chart-subtitle">Volume mensuel 2026</p>
                    </div>
                </div>

                <div class="bar-chart">
                    @for (v of eventsPerMonth(); track $index; let i = $index) {
                    <div class="bar-item">
                        <div class="bar-wrapper">
                            <div class="bar volume" 
                                 [style.height.%]="(v / (maxEventsPerMonth() || 1)) * 100"
                                 [style.animation-delay]="i * 0.05 + 's'">
                                <span class="bar-tooltip">{{ v }}</span>
                            </div>
                        </div>
                        <p class="bar-name">{{ months[i] }}</p>
                    </div>
                    }
                </div>

                <div class="area-chart-legend">
                    <div class="legend-item">
                        <span class="legend-dot box"></span> 
                        <span class="legend-text">Volume</span>
                    </div>
                    <div class="legend-stats">
                        <span>Total: {{ (stats()?.total || 0) }}</span>
                        <span>•</span>
                        <span>Record: {{ maxEventsPerMonth() }}</span>
                    </div>
                </div>
            </div>
        </div>

        <div class="bottom-charts-grid">
            <div class="bar-chart-card">
                <div class="chart-header">
                    <div>
                        <h3 class="chart-title">Répartition par Statut</h3>
                        <p class="chart-subtitle">Tous vos événements</p>
                    </div>
                </div>
                <div class="bar-chart">
                    <div class="bar-item">
                        <div class="bar-wrapper">
                            <div class="bar upcoming" 
                                 [style.height.%]="(statusBreakdown()['À venir'] || 0) / getMaxValue() * 100"
                                 [style.animation-delay]="'0s'">
                                <span class="bar-tooltip">{{ statusBreakdown()['À venir'] }}</span>
                            </div>
                        </div>
                        <p class="bar-name">À venir</p>
                    </div>
                    <div class="bar-item">
                        <div class="bar-wrapper">
                            <div class="bar ongoing" 
                                 [style.height.%]="(statusBreakdown()['En cours'] || 0)  / getMaxValue() * 100"
                                 [style.animation-delay]="'0.1s'">
                                <span class="bar-tooltip">{{ statusBreakdown()['En cours'] }}</span>
                            </div>
                        </div>
                        <p class="bar-name">En cours</p>
                    </div>
                    <div class="bar-item">
                        <div class="bar-wrapper">
                            <div class="bar completed" 
                                 [style.height.%]="(statusBreakdown()['Terminés'] || 0)  / getMaxValue() * 100"
                                 [style.animation-delay]="'0.2s'">
                                <span class="bar-tooltip">{{ statusBreakdown()['Terminés'] }}</span>
                            </div>
                        </div>
                        <p class="bar-name">Terminés</p>
                    </div>
                    <div class="bar-item">
                        <div class="bar-wrapper">
                            <div class="bar pending" 
                                 [style.height.%]="(statusBreakdown()['En attente'] || 0)  / getMaxValue() * 100"
                                 [style.animation-delay]="'0.3s'">
                                <span class="bar-tooltip">{{ statusBreakdown()['En attente'] }}</span>
                            </div>
                        </div>
                        <p class="bar-name">En attente</p>
                    </div>
                    <div class="bar-item">
                        <div class="bar-wrapper">
                            <div class="bar approved" 
                                 [style.height.%]="(statusBreakdown()['Approuvés'] || 0)  / getMaxValue() * 100"
                                 [style.animation-delay]="'0.4s'">
                                <span class="bar-tooltip">{{ statusBreakdown()['Approuvés'] }}</span>
                            </div>
                        </div>
                        <p class="bar-name">Approuvés</p>
                    </div>
                    <div class="bar-item">
                        <div class="bar-wrapper">
                            <div class="bar rejected" 
                                 [style.height.%]="(statusBreakdown()['Rejetés'] || 0)  / getMaxValue() * 100"
                                 [style.animation-delay]="'0.5s'">
                                <span class="bar-tooltip">{{ statusBreakdown()['Rejetés'] }}</span>
                            </div>
                        </div>
                        <p class="bar-name">Rejetés</p>
                    </div>
                    <div class="bar-item">
                        <div class="bar-wrapper">
                            <div class="bar cancelled" 
                                 [style.height.%]="(statusBreakdown()['Annulés'] || 0)  / getMaxValue() * 100"
                                 [style.animation-delay]="'0.6s'">
                                <span class="bar-tooltip">{{ statusBreakdown()['Annulés'] }}</span>
                            </div>
                        </div>
                        <p class="bar-name">Annulés</p>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>