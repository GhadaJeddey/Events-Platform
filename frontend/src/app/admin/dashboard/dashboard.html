<div class="dashboard-container fade-in-up">
  <div class="dashboard-header">
    <div class="header-content">
      <h1 class="header-title">Tableau de Bord Admin</h1>
      <p class="header-date">{{ currentDate | date:'d MMM yyyy' }}</p>
    </div>
  </div>

  @if (!stats()) {
    <div class="loading-state">
      <p>Chargement des statistiques...</p>
    </div>
  } 
  @else {
    <div class="stats-grid">
      <div class="stat-card users-card" routerLink="/admin/users">
        <div class="stat-icon">üë•</div>
        <div class="stat-content">
          <h3>Utilisateurs</h3>
          <p class="stat-number">{{ stats()?.overview?.totalUsers }}</p>
        </div>
      </div>

      <div class="stat-card pending-card" routerLink="/admin/approvals">
        <div class="stat-icon">‚è≥</div>
        <div class="stat-content">
          <h3>En Attente</h3>
          <p class="stat-number">{{ stats()?.overview?.pendingEvents }}</p>
        </div>
      </div>
    </div>

    <div class="room-requests-card">
      <div class="room-requests-header">
        <div>
          <h2>Demandes de salles</h2>
          <p class="subtitle">Validation des cr√©neaux demand√©s</p>
        </div>
        <a routerLink="/admin/approvals" class="view-all-link">Voir tout ‚Üí</a>
      </div>

      <div class="room-requests-list">
        @if (pendingEvents().length > 0) {
          @for (event of pendingEvents(); track event.id) {
            <div class="room-request-item">
              <div class="request-info">
                <div class="request-title">
                  <span class="room-name">{{ event.location }}</span>
                  <span class="request-date">{{ event.startDate | date:'EEE d MMM' }}</span>
                </div>
                <div class="request-meta">
                  <span class="organizer-name">
                    {{ event.organizer?.user?.firstName || 'Un utilisateur' }} {{ event.organizer?.user?.lastName || '' }}
                  </span>
                  <span class="separator">‚Ä¢</span>
                  <span class="event-title">{{ event.title }}</span>
                </div>
                <div class="slot-list">
                  @for (slot of getHourlySlots(event); track slot) {
                    <button class="slot-chip" [class.inactive]="isSlotInactive(event.id, slot)" (click)="toggleSlot(event.id, slot)">
                      {{ slot }}
                    </button>
                  }
                </div>
              </div>
              <div class="request-actions">
                <button class="action-btn approve" (click)="approveEvent(event.id)">Approuver</button>
                <button class="action-btn reject" (click)="rejectEvent(event.id)">Rejeter</button>
              </div>
            </div>
          }
        } @else {
          <p class="no-data">Aucune demande en attente.</p>
        }
      </div>
    </div>

    <div class="charts-section">
      <div class="chart-container">
        <h3>R√©partition des √âv√©nements</h3>
        <div class="canvas-wrapper pie-wrapper">
          <canvas baseChart
            [data]="pieChartData()"
            [type]="'pie'"
            [options]="pieChartOptions">
          </canvas>
        </div>
      </div>

      <div class="chart-container">
        <h3>Top des Salles</h3>
        <div class="canvas-wrapper bar-wrapper">
          @if (roomChartData().labels && roomChartData().labels!.length > 0) {
            <canvas baseChart 
                [data]="roomChartData()" 
                [options]="barChartOptions" 
                [type]="'bar'">
            </canvas>
          } @else {
            <p class="no-data">Aucune donn√©e de salle.</p>
          }
        </div>
      </div>
    </div>

    <div class="recent-activity-container">
      <h3>üïë Activit√© R√©cente</h3>
      <div class="activity-list">
        @for (event of recentActivity(); track event.id) {
          <div class="activity-item">
            <div class="activity-icon" [ngClass]="event.approvalStatus">
              @if(event.approvalStatus === 'approved') { <i class="fas fa-check"></i> }
              @else if(event.approvalStatus === 'rejected') { <i class="fas fa-times"></i> }
              @else { <i class="fas fa-clock"></i> }
            </div>

            <div class="activity-details">
              <p class="activity-text">
                <strong>{{ event.organizer?.user?.firstName || 'Un utilisateur' }} {{event.organizer?.user?.lastName}}</strong> 
                a demand√© :
                <strong>{{ event.location }}</strong>
              </p>
              <p class="activity-subtext">
                {{ event.title }} ‚Ä¢ {{ event.createdAt | date:'dd/MM/yyyy √† HH:mm' }}
              </p>
            </div>

            <div class="status-badge-mini" [ngClass]="event.approvalStatus">
              {{ event.approvalStatus }}
            </div>
          </div>
        } @empty {
          <p class="no-data">Aucune activit√© r√©cente.</p>
        }
      </div>
    </div>
  }
</div>