<div class="event-card" [class.is-cancelled]="event()?.approvalStatus === 'cancelled'" appHoverElevate>
    <div class="event-card-image">
        <img [src]="getImageUrl(event()?.imageUrl)" [alt]="event()?.title" />

        @if (event()?.approvalStatus === 'cancelled') {
        <div class="cancelled-overlay">
            <span class="cancelled-text">ANNULÉ</span>
        </div>
        }

        <div class="event-card-badge">
            <span [appStatusBadge]="event()?.eventStatus">{{ event()?.eventStatus }}</span>
        </div>
    </div>

    <div class="event-card-content">
        <h3 class="event-title">{{ event()?.title }}</h3>

        <div class="event-meta">
            <div class="meta-item">
                <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none"
                    stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                    <rect x="3" y="4" width="18" height="18" rx="2" ry="2"></rect>
                    <line x1="16" y1="2" x2="16" y2="6"></line>
                    <line x1="8" y1="2" x2="8" y2="6"></line>
                    <line x1="3" y1="10" x2="21" y2="10"></line>
                </svg>
                <span>{{ event()?.startDate | date:'dd MMM yyyy' }}</span>
            </div>
            <div class="meta-item">
                <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none"
                    stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                    <path d="M21 10c0 7-9 13-9 13s-9-6-9-13a9 9 0 0 1 18 0z"></path>
                    <circle cx="12" cy="10" r="3"></circle>
                </svg>
                <span>{{ event()?.location }}</span>
            </div>
            <div class="meta-item">
                <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none"
                    stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                    <path d="M3 9l9-7 9 7v11a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2z"></path>
                    <polyline points="9 22 9 12 15 12 15 22"></polyline>
                </svg>
                <span>{{ event()?.organizer?.name }}</span>
            </div>
        </div>

        <!-- Student mode: Links pour voir et s'inscrire -->
        @if (mode() === 'student') {
        <div class="event-card-links">
            <a [routerLink]="event()?.approvalStatus === 'cancelled' ? null : ['/events/details', event()?.id]"
                class="link-details" [class.disabled]="event()?.approvalStatus === 'cancelled'">
                Voir plus <span>&rarr;</span>
            </a>
            @if (isRegistered()) {
            <button (click)="cancelRegistration()" class="link-register btn-cancel"
                [disabled]="isCancelling() || event()?.approvalStatus === 'cancelled'"
                [class.disabled]="event()?.approvalStatus === 'cancelled'">
                {{ isCancelling() ? 'Annulation...' : (event()?.approvalStatus === 'cancelled' ? 'Annulé' : 'Annuler')
                }}
            </button>
            } @else {
            <a [routerLink]="event()?.approvalStatus === 'cancelled' ? null : ['/events/details', event()?.id]"
                class="link-register" [class.disabled]="event()?.approvalStatus === 'cancelled'">
                {{ event()?.approvalStatus === 'cancelled' ? 'Annulé' : "S'inscrire" }}
            </a>
            }
        </div>
        }

        <!-- Organizer mode: Stats et boutons actions -->
        @if (mode() === 'organizer') {
        <div class="event-stats">
            <div class="stat">
                <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none"
                    stroke="currentColor" stroke-width="2">
                    <path d="M17 21v-2a4 4 0 0 0-4-4H5a4 4 0 0 0-4 4v2"></path>
                    <circle cx="9" cy="7" r="4"></circle>
                    <path d="M23 21v-2a4 4 0 0 0-3-3.87"></path>
                    <path d="M16 3.13a4 4 0 0 1 0 7.75"></path>
                </svg>
                <span>{{ event()?.currentRegistrations }} / {{ event()?.capacity }}</span>
            </div>
        </div>
        <div class="event-card-actions">
            <a [routerLink]="['/organizer/events', event()?.id, 'statistics']" class="btn-statistics">
                Statistiques
            </a>
            <a [routerLink]="['/events', event()?.id, 'edit']" class="btn-edit">
                Modifier
            </a>
        </div>
        }
    </div>
</div>